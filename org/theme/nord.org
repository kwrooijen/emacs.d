#+LEXICAL_BINDING: nil
#+PRIORITY: 2

M-x ~kwrooijen/hex-colors-enable~

#FFFFFF
#ECEFF4
#2E3440
#2D323E
#3B4252
#434C5E
#616E88
#81A1C1
#D08770
#BF616A
#FFC16D

 :strong     "#FFFFFF"
 :foreground "#ECEFF4"
 :subtle     "#434C5E"
 :faded      "#616E88"
 :salient    "#81A1C1"
 :popout     "#D08770"
 :error      "#BF616A"
 :warning    "#FFC16D"

 ;; == Tokyo
 :background "#222436"
 :darken     "#1e2030"
 :highlight  "#2f334d")

* Functions

#+BEGIN_SRC emacs-lisp

(defun kwrooijen/define-face (face color &optional color2)
  ;; TODO create combinations
  ;; face/darken-       ;; darken foreground
  ;; face/-darken       ;; darken background
  ;; face/darken-darken ;; darken foreground, darken background
  ;; face/subtle-darken ;; subtle foreground, darken background
;; e.g. darken-white, white-darken, subtle-popout, highlight-foreground.

  (eval `(defface ,(intern (format "kwrooijen/%s-bg-face" face)) `((t (:background ,color))) ""))
  (eval `(defface ,(intern (format "kwrooijen/%s-fg-face" face)) `((t (:foreground ,color))) ""))
  (eval `(defface ,(intern (format "kwrooijen/%s-fb-face" face)) `((t (:foreground ,color :background ,(or color2 color)))) "")))

(defun kwrooijen/set-theme (&rest opts)
  (kwrooijen/define-face 'background (plist-get opts :background))
  (kwrooijen/define-face 'foreground (plist-get opts :foreground))
  (kwrooijen/define-face 'highlight (plist-get opts :highlight))
  (kwrooijen/define-face 'subtle (plist-get opts :subtle))
  (kwrooijen/define-face 'strong (plist-get opts :strong))
  (kwrooijen/define-face 'salient (plist-get opts :salient))
  (kwrooijen/define-face 'popout (plist-get opts :popout))
  (kwrooijen/define-face 'faded (plist-get opts :faded))
  (kwrooijen/define-face 'darken (plist-get opts :darken))
  (kwrooijen/define-face 'faded-darken (plist-get opts :faded) (plist-get opts :darken))
  (kwrooijen/define-face 'error (plist-get opts :error))
  (kwrooijen/define-face 'warning (plist-get opts :error)))

(defun kwrooijen/reset-face-attributes (&rest faces)
  "Reset all attributes of the given FACE."
  (dolist (face faces)
    (set-face-attribute
     face nil
     :foreground 'unspecified
     :inherit 'unspecified
     :stipple 'unspecified
     :background 'unspecified
     :foreground 'unspecified
     :inverse-video 'unspecified
     :box 'unspecified
     :strike-through 'unspecified
     :overline 'unspecified
     :underline 'unspecified
     :slant 'unspecified
     :weight 'unspecified
     :height 'unspecified
     :width 'unspecified
     :foundry 'unspecified
     :family 'unspecified)))

(defun kwrooijen/reset-inherit-face! (&rest face-pairs)
  (dolist (face-pair (-partition 2 face-pairs))
    (let ((face (car face-pair))
          (inherit-face (cadr face-pair)))
      (kwrooijen/reset-face-attributes face)
      (set-face-attribute face nil :inherit inherit-face))))
#+END_SRC

* Nord
:PROPERTIES:
:PACKAGE: nord-theme
:STRAIGHT: (:host github :repo "nordtheme/emacs")
:END:

Install the Roboto font

#+BEGIN_SRC bash
brew tap homebrew/cask-fonts
brew install --cask font-roboto-mono
#+END_SRC


** init :init:
#+BEGIN_SRC emacs-lisp
(defvar kwrooijen/theme 'nord)

(defvar kwrooijen/font "Roboto Mono")

(let ((inhibit-message t)
      (message-log-max nil))
  (load-theme kwrooijen/theme t))

(set-face-attribute 'default nil :family kwrooijen/font)

(kwrooijen/set-theme
 ;; == Original
 :strong     "#FFFFFF"
 :foreground "#ECEFF4"
 ;; :background "#2E3440"
 ;; :darken     "#2D323E"
 ;; :highlight  "#3B4252"
 :subtle     "#434C5E"
 :faded      "#616E88"
 :salient    "#81A1C1"
 :popout     "#D08770"
 :error      "#BF616A"
 :warning    "#FFC16D"

 ;; == Tokyo
 :background "#222436"
 :darken     "#1e2030"
 :highlight  "#2f334d")

(set-frame-parameter nil 'background-color
                        (face-attribute 'kwrooijen/background-bg-face :background))
(custom-theme-set-faces
 kwrooijen/theme
 `(default ((()
             (:foreground ,(face-attribute 'kwrooijen/foreground-fg-face :foreground)
              :background ,(face-attribute 'kwrooijen/background-bg-face :background))))))

(set-face-attribute 'button nil :box 'unspecified)

(kwrooijen/reset-inherit-face!
 'isearch        'kwrooijen/faded-bg-face
 'lazy-highlight 'kwrooijen/subtle-bg-face)

(kwrooijen/reset-inherit-face!
 'error   'kwrooijen/error-fg-face
 'warning 'kwrooijen/warning-fg-face)

(kwrooijen/reset-inherit-face!
 'font-lock-comment-face       'kwrooijen/faded-fg-face
 'font-lock-doc-face           'kwrooijen/faded-fg-face
 'font-lock-string-face        'kwrooijen/popout-fg-face
 'font-lock-constant-face      'kwrooijen/salient-fg-face
 'font-lock-warning-face       'kwrooijen/popout-fg-face
 'font-lock-function-name-face 'kwrooijen/strong-fg-face
 'font-lock-variable-name-face 'kwrooijen/strong-fg-face
 'font-lock-builtin-face       'kwrooijen/salient-fg-face
 'font-lock-type-face          'kwrooijen/salient-fg-face
 'font-lock-keyword-face       'kwrooijen/salient-fg-face)

(kwrooijen/reset-inherit-face! 'minibuffer-prompt 'kwrooijen/salient-fg-face)

(kwrooijen/reset-inherit-face! 'dired-directory 'kwrooijen/salient-fg-face)

(set-face-attribute 'highlight nil :foreground 'unspecified)
(set-face-attribute 'bold nil :foreground "#ffffff" :weight 'bold)

(set-face-attribute 'fringe nil :inherit 'kwrooijen/background-bg-face
:background 'unspecified)

(kwrooijen/reset-inherit-face! 'header-line 'kwrooijen/foreground-fg-face)
#+END_SRC


* Theme
#+BEGIN_SRC emacs-lisp
(defcustom kwrooijen/default-font-size
  200
  "Default font size."
  :type 'integer
  :group 'kwrooijen)

(defun kwrooijen/font-size-set (size)
  "Adjust the global font size by DELTA."
  (let ((current-size (face-attribute 'default :height)))
    (set-face-attribute 'default nil :height size)))

(defun kwrooijen/font-size-increase ()
  "Increase global font size."
  (interactive)
  (kwrooijen/font-size-set (+ (face-attribute 'default :height) 20)))

(defun kwrooijen/font-size-decrease ()
  "Decrease global font size."
  (interactive)
  (kwrooijen/font-size-set (- (face-attribute 'default :height) 20)))

(defun kwrooijen/font-size-reset ()
  "Decrease global font size."
  (interactive)
  (kwrooijen/font-size-set kwrooijen/default-font-size))

(kwrooijen/font-size-set kwrooijen/default-font-size)

(general-define-key
 "C-x C-=" 'kwrooijen/font-size-increase
 "C-x C--" 'kwrooijen/font-size-decrease
 "C-x C-0" 'kwrooijen/font-size-reset)
#+END_SRC


* Helper functions

#+BEGIN_SRC emacs-lisp
(defun kwrooijen/hex-colors-enable ()
  (interactive)
  (font-lock-add-keywords
   nil
   '(("#[[:xdigit:]]\\{6\\}"
      (0 (put-text-property (match-beginning 0) (match-end 0)
                            'face (list :foreground (match-string-no-properties 0)))))))
  (font-lock-mode -1)
  (font-lock-mode 1))

(defun kwrooijen/hex-colors-disable ()
  (interactive)
  (font-lock-remove-keywords
   nil
   '(("#[[:xdigit:]]\\{6\\}"
      (0 (put-text-property (match-beginning 0) (match-end 0)
                            'face (list :foreground (match-string-no-properties 0)))))))
  (font-lock-mode -1)
  (font-lock-mode 1))
  #+END_SRC

* Iedit :config:
:PROPERTIES:
:PACKAGE: iedit
:DEFER: t
:END:
#+BEGIN_SRC emacs-lisp
(kwrooijen/reset-inherit-face! 'iedit-occurrence 'kwrooijen/salient-bg-face)
(set-face-attribute 'iedit-occurrence nil :foreground "#FFFFFF")
#+END_SRC

Recenter screen when iedit is used.

#+BEGIN_SRC emacs-lisp
(advice-add 'iedit-next-occurrence :after #'kwrooijen/recenter)
(advice-add 'iedit-prev-occurrence :after #'kwrooijen/recenter)
#+END_SRC

* Magit :config:
:PROPERTIES:
:PACKAGE: magit
:DEFER: t
:END:

#+BEGIN_SRC emacs-lisp
(kwrooijen/reset-face-attributes 'magit-section-highlight)
(set-face-attribute 'magit-section-highlight nil :foreground 'unspecified :inherit 'highlight)
#+END_SRC


* Org :config:
:PROPERTIES:
:PACKAGE: org
:DEFER: t
:END:
#+BEGIN_SRC emacs-lisp

(kwrooijen/reset-inherit-face!
 'org-block              'kwrooijen/darken-bg-face
 'org-block-begin-line   'kwrooijen/faded-darken-fb-face
 'org-block-end-line     'kwrooijen/faded-darken-fb-face)

(kwrooijen/reset-inherit-face!
 'org-agenda-clocking          'kwrooijen/faded-fg-face
 'org-agenda-column-dateline   'kwrooijen/faded-fg-face
 'org-agenda-date-weekend      'kwrooijen/faded-fg-face
 'org-agenda-diary             'kwrooijen/faded-fg-face
 'org-agenda-dimmed-todo-face  'kwrooijen/faded-fg-face
 'org-agenda-done              'kwrooijen/faded-fg-face
 'org-agenda-filter-category   'kwrooijen/faded-fg-face
 'org-agenda-filter-effort     'kwrooijen/faded-fg-face
 'org-agenda-filter-regexp     'kwrooijen/faded-fg-face
 'org-agenda-filter-tags       'kwrooijen/faded-fg-face
 'org-agenda-restriction-lock  'kwrooijen/faded-fg-face
 'org-archived                 'kwrooijen/faded-fg-face
 'org-checkbox                 'kwrooijen/faded-fg-face
 'org-checkbox-statistics-done 'kwrooijen/faded-fg-face
 'org-checkbox-statistics-todo 'kwrooijen/faded-fg-face
 'org-clock-overlay            'kwrooijen/faded-fg-face
 'org-code                     'kwrooijen/salient-fg-face
 'org-column                   'kwrooijen/faded-fg-face
 'org-column-title             'kwrooijen/faded-fg-face
 'org-date                     'kwrooijen/faded-fg-face
 'org-date-selected            'kwrooijen/faded-fg-face
 'org-default                  'kwrooijen/faded-fg-face
 'org-document-info            'kwrooijen/faded-fg-face
 'org-document-info-keyword    'kwrooijen/faded-fg-face
 'org-document-title           'kwrooijen/faded-fg-face
 'org-drawer                   'kwrooijen/faded-fg-face
 'org-ellipsis                 'kwrooijen/faded-fg-face
 'org-footnote                 'kwrooijen/faded-fg-face
 'org-formula                  'kwrooijen/faded-fg-face
 'org-headline-done            'kwrooijen/faded-fg-face
 'org-latex-and-related        'kwrooijen/faded-fg-face
 'org-list-dt                  'kwrooijen/faded-fg-face
 'org-macro                    'kwrooijen/faded-fg-face
 'org-meta-line                'kwrooijen/faded-fg-face
 'org-mode-line-clock          'kwrooijen/faded-fg-face
 'org-mode-line-clock-overrun  'kwrooijen/faded-fg-face
 'org-priority                 'kwrooijen/faded-fg-face
 'org-property-value           'kwrooijen/faded-fg-face
 'org-quote                    'kwrooijen/faded-fg-face
 'org-scheduled                'kwrooijen/faded-fg-face
 'org-scheduled-previously     'kwrooijen/faded-fg-face
 'org-sexp-date                'kwrooijen/faded-fg-face
 'org-special-keyword          'kwrooijen/faded-fg-face
 'org-tag-group                'kwrooijen/faded-fg-face
 'org-target                   'kwrooijen/faded-fg-face
 'org-time-grid                'kwrooijen/faded-fg-face
 'org-verse                    'kwrooijen/faded-fg-face)

(kwrooijen/reset-inherit-face!
 'org-agenda-calendar-event 'kwrooijen/foreground-fg-face
 'org-done                  'kwrooijen/foreground-fg-face
 'org-level-1               'kwrooijen/foreground-fg-face
 'org-level-2               'kwrooijen/foreground-fg-face
 'org-level-3               'kwrooijen/foreground-fg-face
 'org-level-4               'kwrooijen/foreground-fg-face
 'org-level-5               'kwrooijen/foreground-fg-face
 'org-level-6               'kwrooijen/foreground-fg-face
 'org-level-7               'kwrooijen/foreground-fg-face
 'org-level-8               'kwrooijen/foreground-fg-face
 'org-upcoming-deadline     'kwrooijen/foreground-fg-face)

(kwrooijen/reset-inherit-face!
 'org-tag      'kwrooijen/popout-fg-face
 'org-verbatim 'kwrooijen/popout-fg-face
 'org-warning  'kwrooijen/popout-fg-face)

(kwrooijen/reset-inherit-face!
 'org-agenda-current-time 'kwrooijen/strong-fg-face
 'org-agenda-structure    'kwrooijen/strong-fg-face)

(kwrooijen/reset-inherit-face!
 'org-agenda-calendar-sexp 'kwrooijen/salient-fg-face
 'org-agenda-date          'kwrooijen/salient-fg-face
 'org-link                 'kwrooijen/salient-fg-face
 'org-table                'kwrooijen/salient-fg-face
 'org-todo                 'kwrooijen/salient-fg-face)
#+END_SRC

* Company :config:
:PROPERTIES:
:PACKAGE: company
:DEFER: t
:END:
#+BEGIN_SRC emacs-lisp
(kwrooijen/reset-inherit-face!
 'company-preview-common 'kwrooijen/faded-bg-face
 'company-preview-search 'kwrooijen/faded-bg-face)
#+END_SRC


* Paren :config:
:PROPERTIES:
:PACKAGE: paren
:DEFER: t
:END:

#+BEGIN_SRC emacs-lisp
(kwrooijen/reset-inherit-face! 'show-paren-match 'kwrooijen/salient-fg-face)
(kwrooijen/reset-inherit-face! 'show-paren-mismatch 'kwrooijen/error-fg-face)
(kwrooijen/reset-inherit-face! 'show-paren-match-expression 'kwrooijen/popout-fg-face)
#+END_SRC

* Web Mode :config:
:PROPERTIES:
:PACKAGE: web-mode
:DEFER: t
:END:

#+BEGIN_SRC emacs-lisp
(kwrooijen/reset-inherit-face! 'web-mode-string-face 'font-lock-string-face)
(kwrooijen/reset-inherit-face! 'web-mode-html-attr-value-face 'font-lock-string-face)
(kwrooijen/reset-inherit-face! 'web-mode-symbol-face 'font-lock-keyword-face)
(kwrooijen/reset-inherit-face! 'web-mode-builtin-face 'kwrooijen/strong-fg-face)
(kwrooijen/reset-inherit-face! 'web-mode-variable-name-face 'font-lock-variable-name-face)
(kwrooijen/reset-inherit-face! 'web-mode-variable-name-face 'font-lock-variable-name-face)
(kwrooijen/reset-inherit-face! 'web-mode-current-element-highlight-face 'underline)
#+END_SRC

** Init :init:
#+BEGIN_SRC emacs-lisp
(add-to-list 'auto-mode-alist '("\\.html\\'" . web-mode))
#+END_SRC

* Window divider
:PROPERTIES:
:PACKAGE: frame
:END:

** Init :init:
#+BEGIN_SRC emacs-lisp
(kwrooijen/reset-inherit-face!
 'window-divider             'kwrooijen/background-fb-face
 'window-divider-first-pixel 'kwrooijen/background-fb-face
 'window-divider-last-pixel  'kwrooijen/background-fb-face
 'vertical-border            'kwrooijen/background-fb-face)

;; Vertical window divider
(setq window-divider-default-right-width 24)
(setq window-divider-default-places 'right-only)
(window-divider-mode 1)
#+END_SRC

* Evil Highlight Persist :config:
:PROPERTIES:
:PACKAGE: evil-search-highlight-persist
:DEFER: t
:END:
#+BEGIN_SRC emacs-lisp
(kwrooijen/reset-inherit-face! 'evil-search-highlight-persist-highlight-face 'highlight)
#+END_SRC

* HL Line :config:
:PROPERTIES:
:PACKAGE: hl-line
:DEFER: t
:END:
#+BEGIN_SRC emacs-lisp
(kwrooijen/reset-inherit-face!
 'hl-line 'kwrooijen/highlight-bg-face)
#+END_SRC

* Anzu Overlay :config:
:PROPERTIES:
:PACKAGE: anzu-overlay
:DEFER: t
:END:
#+BEGIN_SRC emacs-lisp
(set-face-attribute 'anzu-overlay-face nil
  :foreground (face-attribute 'kwrooijen/salient-fg-face :foreground)
  :inherit 'kwrooijen/highlight-bg-face)
#+END_SRC

* Diredfl :config:
:PROPERTIES:
:PACKAGE: diredfl
:DEFER: t
:END:
#+BEGIN_SRC emacs-lisp
(kwrooijen/reset-inherit-face! 'diredfl-file-name 'kwrooijen/foreground-fg-face)
(kwrooijen/reset-inherit-face! 'diredfl-file-suffix 'kwrooijen/foreground-fg-face)
(kwrooijen/reset-inherit-face! 'diredfl-dir-name 'kwrooijen/salient-fg-face)
(kwrooijen/reset-inherit-face! 'diredfl-dir-heading 'kwrooijen/salient-fg-face)
(kwrooijen/reset-inherit-face! 'diredfl-dir-priv 'kwrooijen/subtle-fg-face)
(kwrooijen/reset-inherit-face! 'diredfl-date-time 'kwrooijen/faded-fg-face)
(kwrooijen/reset-inherit-face! 'diredfl-read-priv 'kwrooijen/subtle-fg-face)
(kwrooijen/reset-inherit-face! 'diredfl-write-priv 'kwrooijen/subtle-fg-face)
(kwrooijen/reset-inherit-face! 'diredfl-exec-priv 'kwrooijen/subtle-fg-face)
(kwrooijen/reset-inherit-face! 'diredfl-number 'kwrooijen/subtle-fg-face)
(kwrooijen/reset-inherit-face! 'diredfl-no-priv 'kwrooijen/subtle-fg-face)
(kwrooijen/reset-inherit-face! 'diredfl-other-priv 'kwrooijen/subtle-fg-face)
(kwrooijen/reset-inherit-face! 'diredfl-link-priv 'kwrooijen/subtle-fg-face)
(kwrooijen/reset-inherit-face! 'diredfl-symlink 'kwrooijen/faded-fg-face)
(kwrooijen/reset-inherit-face! 'diredfl-compressed-file-name 'kwrooijen/faded-fg-face)
(kwrooijen/reset-inherit-face! 'diredfl-compressed-file-suffix 'kwrooijen/faded-fg-face)
(kwrooijen/reset-face-attributes 'diredfl-ignored-file-name)
#+END_SRC


* Subwindow

Give subwindows (magit, repl, shell, minibuffer, etc) a different
style. Similar to Solaire mode, but more flexible.

#+BEGIN_SRC emacs-lisp
(defvar-local kwrooijen/subwindow-needs-style nil)

(defun kwrooijen/subwindow-styling (win)
  (when kwrooijen/subwindow-needs-style
    (set-window-fringes win 24 24)
    (setq header-line-format " ")
    (face-remap-add-relative 'fringe :inherit 'kwrooijen/darken-fb-face)
    (face-remap-add-relative 'header-line :inherit 'kwrooijen/darken-bg-face :height 190)
    (face-remap-add-relative 'default :inherit 'kwrooijen/darken-bg-face)))

(defun kwrooijen/subwindow-setup-hook ()
  (setq kwrooijen/subwindow-needs-style t))

(defun kwrooijen/subwindow-setup-hook-transient ()
  ;; Transient has special needs when it comes to getting the proper
  ;; buffer.
  (when (get-buffer (or transient--buffer-name ""))
    (with-current-buffer (get-buffer (or transient--buffer-name ""))
      (setq kwrooijen/subwindow-needs-style t))))

(defun kwrooijen/subwindow-restyle ()
  (dolist (win (window-list))
    (with-current-buffer (window-buffer win)
      (kwrooijen/subwindow-styling win))))
#+END_SRC

#+BEGIN_SRC emacs-lisp
(add-hook 'window-configuration-change-hook #'kwrooijen/subwindow-restyle)
#+END_SRC

#+BEGIN_SRC emacs-lisp
(defcustom kwrooijen/subwindow-hook-list
  '(cider-repl-mode-hook
    magit-mode-hook
    dired-mode-hook
    sql-interactive-mode-hook
    eshell-mode-hook
    inf-ruby-mode-hook
    messages-buffer-mode-hook)
  "List of hooks on which to run `kwrooijen/subwindow-setup-hook`."
  :type '(repeat symbol)
  :group 'kwrooijen)

(add-hook 'transient-setup-buffer-hook #'kwrooijen/subwindow-setup-hook-transient)

(dolist (hook kwrooijen/subwindow-hook-list)
  (add-hook hook #'kwrooijen/subwindow-setup-hook))

(defun minibuffer-subwindow-hook ()
 (face-remap-add-relative 'default '(:background "#1e2030"))
 (face-remap-add-relative 'minibuffer-prompt '(:background "#1e2030"))
 (set-window-margins (minibuffer-window) 2 2))

(add-hook 'minibuffer-setup-hook 'minibuffer-subwindow-hook)

(when (buffer-live-p (get-buffer "*Messages*"))
  (with-current-buffer "*Messages*"
    (setq kwrooijen/subwindow-needs-style t)))
#+END_SRC
