* Highlight TODO
:PROPERTIES:
:PACKAGE: hl-todo
:STRAIGHT: t
:END:

** Custom :custom:
#+BEGIN_SRC emacs-lisp
(hl-todo-keyword-faces
 '(("TODO"   . "#FF0000")
   ("FIXME"  . "#FF0000")
   ("DEBUG"  . "#A020F0")
   ("GOTCHA" . "#FF4500")
   ("STUB"   . "#1E90FF")))
#+END_SRC

** hook :hook:
#+BEGIN_SRC emacs-lisp
(prog-mode . hl-todo-mode)
#+END_SRC

* Visual line mode
:PROPERTIES:
:PACKAGE: simple
:END:

When Visual Line mode is enabled, `word-wrap` is turned on, and simple
editing commands are redefined to act on visual lines, not logical
lines.  See Info node `Visual Line Mode` for details.  Turning on this
mode disables line truncation set up by variables `truncate-lines` and
`truncate-partial-width-windows'.

** Init

#+BEGIN_SRC emacs-lisp
(global-visual-line-mode 1)
#+END_SRC

* Highlight numbers
:PROPERTIES:
:PACKAGE: highlight-numbers
:STRAIGHT: t
:END:
** Hook :hook:
#+BEGIN_SRC emacs-lisp
((prog-mode . highlight-numbers-mode)
 (org-mode . highlight-numbers-mode))
#+END_SRC

* Dimmer
:PROPERTIES:
:PACKAGE: dimmer
:STRAIGHT: t
:END:

** Init :init:
#+BEGIN_SRC emacs-lisp
(require 'dimmer)
#+END_SRC

** Custom :custom:
#+BEGIN_SRC emacs-lisp
(dimmer-fraction 0.8)
(dimmer-watch-frame-focus-events nil)
#+END_SRC

** Config :config:
#+BEGIN_SRC emacs-lisp
(defgroup kwrooijen/minibuffer-dim nil
  "Customization for minibuffer-aware dimming rules."
  :group 'convenience)

(defcustom kwrooijen/minibuffer-dim-excluded-commands
  '(consult-line
    consult-yank-from-kill-ring
    consult-ripgrep
    magit-discard
    anzu-query-replace
    kwrooijen/consult-ripgrep-symbol-at-point)

  "Commands for which the original window should not be dimmed.
When the minibuffer is activated by one of these commands,
the selected window will be restored (not dimmed)."
  :type '(repeat symbol))

(defun kwrooijen/dimmer-dim-all ()
  "Dim all buffers."
  (mapc (lambda (buf)
          (with-current-buffer buf
            (unless (minibufferp)
              (dimmer-dim-buffer buf dimmer-fraction))))
        (dimmer-visible-buffer-list)))

(defun kwrooijen/minibuffer-dim-all-initialize ()
  "Dim all buffers except for commands listed in `kwrooijen/minibuffer-dim-excluded-commands'."
  (kwrooijen/dimmer-dim-all)
  (when (memq this-command kwrooijen/minibuffer-dim-excluded-commands)
    (dimmer-restore-buffer (window-buffer (minibuffer-selected-window)))))

;;;###autoload
(define-minor-mode kwrooijen/minibuffer-dim-mode
  "Toggle dimming adjustments for Minibuffer."
  :global t
  (if kwrooijen/minibuffer-dim-mode
      (progn
        (add-to-list 'dimmer-exclusion-regexp-list ".*Minibuf.*")

        (add-hook 'minibuffer-setup-hook #'kwrooijen/minibuffer-dim-all-initialize)
        (add-hook 'minibuffer-exit-hook #'dimmer-restore-all))

        (remove-hook 'minibuffer-setup-hook #'kwrooijen/minibuffer-dim-all-initialize)
        (remove-hook 'minibuffer-exit-hook #'dimmer-restore-all)))

(kwrooijen/minibuffer-dim-mode)
#+END_SRC
* Hl line mode
:PROPERTIES:
:PACKAGE: hl-line
:END:

** Hook :hook:
#+BEGIN_SRC emacs-lisp
((prog-mode . hl-line-mode)
 (text-mode . hl-line-mode)
 (messages-buffer-mode . hl-line-mode))
#+END_SRC


* Subwindow

Give subwindows (magit, repl, shell, minibuffer, etc) a different
style. Similar to Solaire mode, but more flexible.

#+BEGIN_SRC emacs-lisp
(defvar-local kwrooijen/subwindow-needs-style nil)

(defun kwrooijen/subwindow-styling (win)
  (when kwrooijen/subwindow-needs-style
    (set-window-fringes win 24 24)
    (setq header-line-format " ")
    (face-remap-add-relative 'fringe :inherit 'kwrooijen/darken-fb-face)
    (face-remap-add-relative 'header-line :inherit 'kwrooijen/darken-bg-face :height 190)
    (face-remap-add-relative 'default :inherit 'kwrooijen/darken-bg-face)))

(defun kwrooijen/subwindow-setup-hook ()
  (setq kwrooijen/subwindow-needs-style t))

(defun kwrooijen/subwindow-setup-hook-transient ()
  ;; Transient has special needs when it comes to getting the proper
  ;; buffer.
  (when (get-buffer (or transient--buffer-name ""))
    (with-current-buffer (get-buffer (or transient--buffer-name ""))
      (setq kwrooijen/subwindow-needs-style t))))

(defun kwrooijen/subwindow-restyle ()
  (dolist (win (window-list))
    (with-current-buffer (window-buffer win)
      (kwrooijen/subwindow-styling win))))
#+END_SRC

#+BEGIN_SRC emacs-lisp
(add-hook 'window-configuration-change-hook #'kwrooijen/subwindow-restyle)
#+END_SRC

#+BEGIN_SRC emacs-lisp
(defcustom kwrooijen/subwindow-hook-list
  '(cider-repl-mode-hook
    magit-mode-hook
    dired-mode-hook
    sql-interactive-mode-hook
    eshell-mode-hook
    inf-ruby-mode-hook
    messages-buffer-mode-hook)
  "List of hooks on which to run `kwrooijen/subwindow-setup-hook`."
  :type '(repeat symbol)
  :group 'kwrooijen)

(add-hook 'transient-setup-buffer-hook #'kwrooijen/subwindow-setup-hook-transient)

(dolist (hook kwrooijen/subwindow-hook-list)
  (add-hook hook #'kwrooijen/subwindow-setup-hook))

(defun minibuffer-subwindow-hook ()
 (face-remap-add-relative 'default '(:background "#1e2030"))
 (face-remap-add-relative 'minibuffer-prompt '(:background "#1e2030"))
 (set-window-margins (minibuffer-window) 2 2))

(add-hook 'minibuffer-setup-hook 'minibuffer-subwindow-hook)

(when (buffer-live-p (get-buffer "*Messages*"))
  (with-current-buffer "*Messages*"
    (setq kwrooijen/subwindow-needs-style t)))
#+END_SRC
